{
  "name": "PaiwanTalk WebUI Flow",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "paiwantalk",
        "responseMode": "onReceived",
        "responseData": "default",
        "options": {
          "responseContentType": "application/json"
        }
      },
      "id": "WebUI Webhook",
      "name": "WebUI Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        260,
        300
      ],
      "webhookId": "paiwantalk-webhook-id"
    },
    {
      "parameters": {
        "url": "http://210.61.209.139:45014/v1/chat/completions",
        "method": "POST",
        "authentication": "none",
        "jsonParameters": true,
        "options": {},
        "headerParametersJson": "={\"Content-Type\": \"application/json\"}",
        "bodyParametersJson": "={\n  \"model\": \"gpt-oss-120b\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"You are an intent classifier for a Paiwan language learning assistant. Your job is to read the user's message and decide which action the system should take. The available actions are: paiwan_translate, example_search, web_search, chitchat. You MUST respond in valid JSON, for example: {\\\"action\\\":\\\"paiwan_translate\\\",\\\"language\\\":\\\"paiwan\\\"}. Do not output anything except this JSON.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"使用者訊息：<USER_TEXT>\"\n    }\n  ],\n  \"temperature\": 0\n}"
      },
      "id": "LLM Intent (vLLM)",
      "name": "LLM Intent (vLLM)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        540,
        300
      ]
    },
    {
      "parameters": {
        "functionCode": "const content = items[0].json.choices[0].message.content;\nlet parsed;\ntry {\n  parsed = JSON.parse(content);\n} catch (e) {\n  parsed = { action: 'chitchat', language: 'other', raw: content };\n}\nreturn [{ json: parsed }];"
      },
      "id": "Parse Intent JSON",
      "name": "Parse Intent JSON",
      "type": "n8n-nodes-base.function",
      "typeVersion": 2,
      "position": [
        820,
        300
      ]
    },
    {
      "parameters": {
        "property": "action",
        "rules": {
          "rules": [
            {
              "value": "paiwan_translate"
            },
            {
              "value": "example_search"
            },
            {
              "value": "web_search"
            },
            {
              "value": "chitchat"
            }
          ]
        }
      },
      "id": "Route by Action",
      "name": "Route by Action",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 2,
      "position": [
        1080,
        300
      ]
    },
    {
      "parameters": {
        "url": "http://localhost:8000/api/paiwan/translate",
        "method": "POST",
        "authentication": "none",
        "jsonParameters": true,
        "options": {},
        "headerParametersJson": "={\"Content-Type\": \"application/json\"}",
        "bodyParametersJson": "={\n  \"text\": \"<USER_TEXT>\"\n}"
      },
      "id": "Paiwan Translate",
      "name": "Paiwan Translate",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        1340,
        140
      ]
    },
    {
      "parameters": {
        "url": "http://localhost:8000/api/paiwan/examples",
        "method": "POST",
        "authentication": "none",
        "jsonParameters": true,
        "options": {},
        "headerParametersJson": "={\"Content-Type\": \"application/json\"}",
        "bodyParametersJson": "={\n  \"text\": \"<USER_TEXT>\"\n}"
      },
      "id": "Example Search",
      "name": "Example Search",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        1340,
        300
      ]
    },
    {
      "parameters": {
        "url": "http://210.61.209.139:45014/v1/chat/completions",
        "method": "POST",
        "authentication": "none",
        "jsonParameters": true,
        "options": {},
        "headerParametersJson": "={\"Content-Type\": \"application/json\"}",
        "bodyParametersJson": "={\n  \"model\": \"gpt-oss-120b\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"You are a helpful assistant that may use external information. Reply in Traditional Chinese.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"<USER_TEXT>\"\n    }\n  ],\n  \"temperature\": 0.7\n}"
      },
      "id": "Web Search / Other",
      "name": "Web Search / Other",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        1340,
        460
      ]
    },
    {
      "parameters": {
        "url": "http://210.61.209.139:45014/v1/chat/completions",
        "method": "POST",
        "authentication": "none",
        "jsonParameters": true,
        "options": {},
        "headerParametersJson": "={\"Content-Type\": \"application/json\"}",
        "bodyParametersJson": "={\n  \"model\": \"gpt-oss-120b\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": \"You are a friendly chatbot that replies in Traditional Chinese.\"\n    },\n    {\n      \"role\": \"user\",\n      \"content\": \"<USER_TEXT>\"\n    }\n  ],\n  \"temperature\": 0.7\n}"
      },
      "id": "ChitChat (vLLM)",
      "name": "ChitChat (vLLM)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [
        1340,
        620
      ]
    },
    {
      "parameters": {
        "responseMode": "lastNode",
        "responseContentType": "application/json",
        "options": {
          "responsePropertyName": "data"
        }
      },
      "id": "Return to WebUI",
      "name": "Return to WebUI",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        1600,
        300
      ]
    }
  ],
  "connections": {
    "WebUI Webhook": {
      "main": [
        [
          {
            "node": "LLM Intent (vLLM)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM Intent (vLLM)": {
      "main": [
        [
          {
            "node": "Parse Intent JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Intent JSON": {
      "main": [
        [
          {
            "node": "Route by Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Action": {
      "main": [
        [
          {
            "node": "Paiwan Translate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Example Search",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Web Search / Other",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ChitChat (vLLM)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Paiwan Translate": {
      "main": [
        [
          {
            "node": "Return to WebUI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Example Search": {
      "main": [
        [
          {
            "node": "Return to WebUI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Web Search / Other": {
      "main": [
        [
          {
            "node": "Return to WebUI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ChitChat (vLLM)": {
      "main": [
        [
          {
            "node": "Return to WebUI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {},
  "versionId": "paiwantalk-webui-flow-v1"
}
